# Fake Malware Generation

This repository contains the code for the following tasks:

1. Generation of DistilBERT CLS token embeddings of 3 malware family files (WinWebSec, Zbot, Zeroaccess)

2. Training of WGAN-GP model to generate CLS token embeddings of the malware families.

3. Visualization of the original and generated token embeddings through a heatmap and analysis of the visualization.

4. Testing the quality of the generated malware embeddings using novelty detection models (One Class SVM, Isolation Forest, Local Outlier Factor)

5. Training classification models (Logistic Regression, Random Forest, Support Vector Machine, Gradient Boosting) on original embeddings and testing them on original and generated embeddings.

Please find the document detailing the project at the following link: [Document](https://docs.google.com/document/d/1SIZOidTCIQ8PH-uxcxjdsAIBDiU5XYndSYpbT9XVeVI/edit?usp=sharing)

## Getting Started

### Create a virtual environment

```
python3 -m venv myenv
```

### Activate the virtual environment

```
source myenv/bin/activate
```

### Install dependencies from requirements.txt

```
pip install -r requirements.txt
```

## Dataset

Mnemonic opcodes of the below mentioned malware families:

- WinWebSec - Displays fake system alerts and alters system setting - 4360 samples
- Zbot - Steal sensitive information - 2136
- Zeroaccess - Illicit cryptocurrency mining and invoking fraudulent clicks - 1305

## Genrating DistilBERT CLS token embeddings

Use `run_preprocessing.py` to generate scaled DistilBERT CLS token embeddings of the mnemonic opcodes of the malware files. Make sure to set the appropriate input_dir and output_dir fields in the file before running it.

## Training WGAN-GP model

To train the WGAN-GP model for generating CLS token embeddings of the malware families, run the `train_wgan_gp.py` script.

This script will train the WGAN-GP model using the preprocessed data and save the generated embeddings.

Make sure to set the appropriate parameters in the `train_wgan_gp.py` script before running it, such as the number of epochs, batch size, learning rate, etc.

After running the script, you can proceed to the next step of visualizing the original and generated token embeddings.

## Visualizing the original and generated token embeddings

To visualize the original and generated token embeddings, you can use the `visualize_malware.py` script. Make sure to set the appropriate input_dir and output_dir fields in the file before running it.

## Testing the quality of the generated malware embeddings using novelty detection models

To test the quality of the generated malware embeddings, you can use the `novelty_detection.py` script. This script applies novelty detection models, such as One Class SVM, Isolation Forest, and Local Outlier Factor, to classify the embeddings as either normal or anomalous.

Before running the script, make sure to set the appropriate input_dir and model parameters in the file. The input_dir should point to the directory containing the original and generated embeddings. The model parameters can be adjusted based on your requirements.

Once you have set the parameters, you can run the `novelty_detection.py` script to perform the novelty detection analysis. The script will generate classification results and evaluation metrics, such as precision, recall, and F1-score, to assess the qu
ality of the generated embeddings.

It is recommended to experiment with different novelty detection models and parameters to find the best configuration for your specific use case.

After testing the quality of the generated malware embeddings, you can proceed to the next step of training classification models (supervised learning model to classify malware embeddings into their respective families) on the original embeddings and testing the classification model on the generated embeddings.

## Training Classification Models

To train classification models on the original embeddings and test them on both the original and generated embeddings, you can use the `malware_classification.py` script.

Before running the script, make sure to set the appropriate input_dir and model parameters in the file. The input_dir should point to the directory containing the original and generated embeddings. The model parameters can be adjusted based on your requirements.

Once you have set the parameters, you can run the `malware_classification.py` script to train the classification models. The script will use supervised learning techniques, such as Logistic Regression, Random Forest, Support Vector Machine, and Gradient Boosting, to classify the malware embeddings into their respective families.

After training the models, you can evaluate their performance on both the original and generated embeddings. The script will generate evaluation metrics, such as accuracy, precision, recall, and F1-score, to assess the performance of the classification models.

It is recommended to experiment with different classification models and parameters to find the best configuration for your specific use case.

Please note that the `malware_classification.py` script assumes that you have already generated the embeddings and preprocessed the data using the previous steps mentioned in this README file.

Feel free to explore the code and make any necessary modifications to suit your needs.
